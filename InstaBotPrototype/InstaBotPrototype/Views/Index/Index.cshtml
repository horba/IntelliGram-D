
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <title>Instagram Bot settings</title>
    <link rel="stylesheet" type="text/css" href="~/css/styles.css">
</head>
<body>
        <div class="page-container">
        <div class="header"><h1>Instagram bot admin page</h1></div>
        <div class="content-container">
            <div class="content-left"></div>
            <div class="content-center">
                <div class="block">
                    <form id="config_form">
                        <div>
                            <label>instagram username</label>
                            <input name="instaUsername" type="text" value="" placeholder="Johnsmith" />
                        </div>
                        <div>
                            <label>instagram password</label>
                            <input name="instaPassword" type="text" value="" placeholder="Password" />
                        </div>
                        <div>
                            <label>telegram username</label>
                            <input name="telegramUsername" type="text" value="" placeholder="john11" />
                            <a href="https://t.me/isdTestBot">Go to the telegram bot</a>
                            <label id="labelNumber" />
                            <script>
                                document.getElementById('labelNumber').innerHTML = 100000000000000000 * Math.random();
                            </script>
                        </div>
                        <div>
                            <label>tags</label>
                            <input name="tags" type="text" value="" placeholder="kittens, cats" />
                        </div>
                        <div>
                            <label>topics</label>
                            <input name="topics" type="text" value="" placeholder="nature, lake" />
                        </div>
                    </form>
                    <div>
                        <button id="get_config">Get configuration</button>
                        <button id="save_config">Save configuration</button>
                    </div>
                    <div id="ajax_result"></div>
                </div>
                <div class="block">
                    <h3>Statistics</h3>
                    <div>Processed <span id="processed_posts">1012</span> posts</div>
                    <div>Matched 21 photos</div>
                    <div>Matched tags: 12</div>
                    <div>Matched topics: 9</div>
                </div>
            </div>
            <div class="content-right"></div>
        </div>
        <div class="footer">© 2017 IntelliGram-D</div>
        </div>
    

<script src="js/jquery-3.2.1.min.js"></script>
<script>
    $(function() {//jquery magic to run script after page fully loaded
        $("#get_config").click(function(e) {
            e.preventDefault();
            $.get("/api/configuration").done(function (data) {   
                console.log(data);
                let values = data;
                for (var fieldName in values) {
                    if (values.hasOwnProperty(fieldName)) {                        
                        $('#config_form input[name=' + fieldName + ']').val(values[fieldName]);//magic - putting values into corresponding fields
                    }
                };
                
                
            });
        });
        $("#save_config").click(function(e) {
            e.preventDefault();
            let data = {
                instaUsername: $("input[name='instaUsername']").val(),
                instaPassword: $("input[name='instaPassword']").val(),
                telegramUsername: $("input[name='telegramUsername']").val(), 
            };

            let tags = [];
            let splitTags = $("input[name='tags']").val().split(',');
            splitTags.forEach(tag => tags.push({ tag: tag }));

            let topics = [];
            let splitTopics = $("input[name='topics']").val().split(',');
            splitTopics.forEach(topic => topics.push({ topic: topic }));

            data['tags'] = tags;
            data['topics'] = topics;

            $.ajax('/api/configuration', {method: 'POST', data: $.param(data)})
                .then(function (response) {
                    console.log('success', response);
                });
        });
    });
</script>

</body>
</html>